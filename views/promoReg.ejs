<% layout('layout') %>

<div class="container mt-5">
  <h2 class="mb-4 text-center">프로모션 설정</h2>

  <!-- 프로모션 설정 그룹 -->
  <form id="promoForm" method="POST" action="/promoReg">
    <div class="border rounded p-4 mb-4">
      <h4 class="mb-3">프로모션 정보</h4>
      <div class="mb-3">
        <label for="promoName" class="form-label">프로모션 이름</label>
        <input type="text" class="form-control" id="promoName" name="promoName" required>
      </div>
      <div class="mb-3">
        <label for="promoCount" class="form-label">인원 수</label>
        <input type="number" class="form-control" id="promoCount" name="promoCount" min="1" max="100" required>
      </div>
      <button type="button" class="btn btn-outline-primary" onclick="generatePromoTables()">테이블 생성</button>
    </div>

    <!-- 참가자 테이블 영역 -->
    <div id="promoTables" class="d-flex flex-column gap-3"></div>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-primary">등록 완료</button>
    </div>
  </form>
</div>

<script>
  const allUsers = <%- JSON.stringify(typeof users !== 'undefined' ? users : []) %>;

  function generatePromoTables() {
    const count = parseInt(document.getElementById('promoCount').value);
    const container = document.getElementById('promoTables');
    container.innerHTML = '';

    if (isNaN(count) || count <= 0) return;

    for (let i = 0; i < count; i++) {
      const wrapper = document.createElement('div');
      wrapper.className = 'border p-3 rounded';

      const label = document.createElement('label');
      label.innerText = `참가자 ${i + 1}`;
      label.className = 'form-label';

      const select = document.createElement('select');
      select.name = `participants[]`;
      select.className = 'form-select';
      select.required = true;

      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.innerText = '이름 선택';
      select.appendChild(defaultOption);

      allUsers.forEach(user => {
        const opt = document.createElement('option');
        opt.value = user.username;
        opt.innerText = user.name;
        select.appendChild(opt);
      });

      wrapper.appendChild(label);
      wrapper.appendChild(select);
      container.appendChild(wrapper);
    }
  }
</script>

<% layout('layout') %>

<div class="container mt-5">

  <h2 class="mb-4 text-center"><%= post.title %></h2>

  <div class="border rounded p-3 mb-4">
    <h4 class="mb-4 text-center">정산 내역서</h4>

    <!-- ✅ 반응형 테이블 래퍼 -->
    <div class="table-responsive">
      <table class="table table-bordered text-center text-nowrap align-middle">
        <colgroup>
          <col style="width: 20%;">
          <col style="width: 30%;">
          <col style="width: 20%;">
          <col style="width: 30%;">
        </colgroup>

        <!-- 라이더 정보 -->
        <tr class="table-secondary"><th colspan="4" class="bg-light">라이더 정보</th></tr>
        <tr>
          <td class="bg-light">라이더 명</td><td><%= post.riderName %></td>
          <td class="bg-light">수행 건수</td><td><%= post.taskCount %></td>
        </tr>
        <tr><td class="bg-light">주민번호</td><td><%= post.residentId %></td></tr>
        <tr>
          <td class="bg-light">은행명</td><td><%= user.bankName %></td>
          <td class="bg-light">계좌 번호</td><td><%= post.accountNumber %></td>
        </tr>
        <tr><td class="bg-light">예금주</td><td><%= post.depositAccount %></td></tr>

        <!-- 이하 동일: 구간별 배경색 유지, colspan 구조 유지 -->
        <!-- ... 위 코드 그대로 유지 가능 ... -->

        <!-- 정산 기간 -->
        <tr class="table-secondary"><th colspan="4" class="bg-light">정산 기간</th></tr>
        <tr><td class="bg-light" colspan="2">정산 시작일</td><td colspan="2"><%= post.settlementStart %></td></tr>
        <tr><td class="bg-light" colspan="2">정산 종료일</td><td colspan="2"><%= post.settlementEnd %></td></tr>
        <tr><td class="bg-light" colspan="2">정산 지급일</td><td colspan="2"><%= post.payDay %></td></tr>
      </table>
    </div>

    <!-- ✅ 본인 확인 영역 -->
    <% if (!['krogy', 'admin'].includes(user.username)) { %>
      <div class="mt-4 text-center">
        <% if (post.confirmed === 'yes') { %>
          <h5>✅ 확인함</h5>
        <% } else { %>
          <form method="POST" action="/post/<%= post._id %>/confirm">
            <div class="form-check form-check-inline mb-3">
              <input class="form-check-input" type="checkbox" id="confirmCheck" name="confirm" required>
              <label class="form-check-label" for="confirmCheck">정산서 내용을 확인합니다</label>
            </div>
            <div>
              <button type="submit" class="btn btn-outline-primary">확인</button>
            </div>
          </form>
        <% } %>
      </div>
    <% } %>

    <!-- ✅ 하단 버튼 -->
    <div class="text-center mt-4">
      <% if (['krogy', 'admin'].includes(user.username)) { %>
        <form action="/post/<%= post._id %>/delete" method="POST" onsubmit="return confirm('정말 삭제하시겠습니까?');">
          <button type="submit" class="btn btn-danger">삭제하기</button>
          <a href="/my-posts" class="btn btn-secondary ms-2">목록으로</a>
        </form>
      <% } else { %>
        <a href="/my-posts" class="btn btn-secondary">목록으로</a>
      <% } %>
    </div>
  </div>
</div>

<style>
  @media (max-width: 576px) {
    h2, h4, h5 {
      font-size: 1.25rem;
    }
    table, td, th {
      font-size: 13px;
    }
    .btn {
      font-size: 14px;
      padding: 6px 12px;
    }
  }
</style>

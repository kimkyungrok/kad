<% layout('layout') %>

<% title = '기사 등록'; %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">

      <h2 class="mb-4 text-center">기사 정보 등록 및 사이트 가입</h2>

      <form id="registerForm" action="/register" method="POST">
<!-- 협력사 등록 그룹 -->
<div class="border rounded p-4 mb-4">
  <h4 class="mb-4">협력사 등록</h4>

  <!-- 아이디 입력 -->
  <div class="mb-3">
    <label for="username" class="form-label">아이디 <span class="text-danger">*</span></label>
    <div class="input-group">
      <input type="text" class="form-control" id="username" name="username" required placeholder="아이디 입력">
      <button class="btn btn-outline-secondary" type="button" id="checkUsernameBtn">중복확인</button>
    </div>
  </div>

  <!-- 비밀번호 -->
  <div class="mb-3">
    <label for="password" class="form-label">비밀번호 <span class="text-danger">*</span></label>
    <div class="input-group">
      <input type="password" class="form-control" id="password" name="password" required placeholder="비밀번호 입력" style="color: black; background-color: rgb(174, 190, 250);">
      <button class="btn btn-outline-secondary" type="button" id="togglePassword">보기</button>
    </div>
    <small class="form-text text-muted">비밀번호는 영문, 숫자, 특수문자를 모두 포함해야 합니다.</small>
  </div>

  <!-- 비밀번호 확인 -->
  <div class="mb-3">
    <label for="passwordConfirm" class="form-label">비밀번호 확인 <span class="text-danger">*</span></label>
    <div class="input-group">
      <input type="password" class="form-control" id="passwordConfirm" name="passwordConfirm" required placeholder="비밀번호 재입력" style="color: black; background-color: rgb(174, 190, 250);">
      <button class="btn btn-outline-secondary" type="button" id="togglePasswordConfirm">보기</button>
    </div>
  </div>

  <!-- 은행 정보 추가 -->
  <!-- 은행명 선택 -->
  <div class="mb-3">
    <label for="bankNameSelect" class="form-label">은행명 <span class="text-danger">*</span></label>
    <select class="form-select" id="bankNameSelect" name="bankNameSelect" required>
      <option value="">은행 선택</option>
      <option value="국민은행">국민은행</option>
      <option value="농협">농협</option>
      <option value="신한은행">신한은행</option>
      <option value="우리은행">우리은행</option>
      <option value="하나은행">하나은행</option>
      <option value="기업은행">기업은행</option>
      <option value="카카오뱅크">카카오뱅크</option>
      <option value="케이뱅크">케이뱅크</option>
      <option value="토스뱅크">토스뱅크</option>
      <option value="씨티은행">씨티은행</option>
      <option value="SC제일은행">SC제일은행</option>
      <option value="부산은행">부산은행</option>
      <option value="대구은행">대구은행</option>
      <option value="광주은행">광주은행</option>
      <option value="전북은행">전북은행</option>
      <option value="경남은행">경남은행</option>
      <option value="수협은행">수협은행</option>
      <option value="우체국">우체국</option>
      <option value="산림조합중앙회">산림조합중앙회</option>
      <option value="직접입력">직접입력</option>
    </select>
  </div>

  <!-- 직접 입력 -->
  <div class="mb-3">
    <input type="text" class="form-control" id="bankNameInput" name="bankNameInput"
           placeholder="직접 은행명 입력" disabled>
  </div>

  <!-- 계좌번호 -->
  <div class="mb-3">
    <label for="accountNumber" class="form-label">계좌번호 <span class="text-danger">*</span></label>
    <input type="text" class="form-control" id="accountNumber" name="accountNumber" required placeholder="계좌번호 입력">
  </div>

  <!-- 예금주 -->
  <div class="mb-3">
    <label for="depositAccount" class="form-label">예금주 <span class="text-danger">*</span></label>
    <input type="text" class="form-control" id="depositAccount" name="depositAccount" required placeholder="예금주 입력">
  </div>
</div>
        <!-- 배민 정보 입력 그룹 -->
        <div class="border rounded p-4 mb-4">
          <h4 class="mb-4">배민 정보 입력</h4>

          <!-- 이름 -->
          <div class="mb-3">
            <label for="name" class="form-label">이름 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="name" name="name" required placeholder="이름 입력">
          </div>

          <!-- 배민커넥트 아이디 -->
          <div class="mb-3">
            <label for="connectId" class="form-label">배민커넥트 아이디 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="connectId" name="connectId" required placeholder="배민커넥트 아이디 입력">
          </div>

          <!-- 전화번호 -->
          <div class="mb-3">
            <label for="phone" class="form-label">전화번호 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="phone" name="phone" required placeholder="전화번호 입력 (010-1234-5678)">
          </div>

          <!-- 생년월일 -->
          <div class="mb-3">
            <label for="birthdate" class="form-label">생년월일 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="birthdate" name="birthdate" required placeholder="생년월일을 입력하세요 (ex.1900.01.01)">
          </div>

          <!-- 가입 지사 선택 -->
          <div class="mb-3">
            <label for="branch" class="form-label">가입 지사 선택 <span class="text-danger">*</span></label>
            <select class="form-select" id="branch" name="branch" required>
              <option value="">지사를 선택하세요</option>
              <option value="칠곡">칠곡</option>
              <option value="시지">시지</option>
              <option value="경산">경산</option>
            </select>
          </div>

        </div>

        <!-- 제출 버튼 -->
        <button type="submit" class="btn btn-primary w-100">회원가입 완료</button>
      </form>

      <div class="text-center mt-3">
        <p>이미 계정이 있으신가요? <a href="/login">로그인</a></p>
      </div>

    </div>
  </div>
</div>

<script>
  const phoneInput = document.getElementById('phone');
  phoneInput.addEventListener('input', function(e) {
    let numbers = e.target.value.replace(/[^0-9]/g, '');
    if (e.inputType !== 'deleteContentBackward' && e.target.value.match(/[^0-9\-]/g)) {
      alert('전화번호는 숫자만 입력 가능합니다.');
    }
    if (numbers.length > 3 && numbers.length <= 7) {
      e.target.value = numbers.replace(/(\d{3})(\d{1,4})/, '$1-$2');
    } else if (numbers.length > 7) {
      e.target.value = numbers.replace(/(\d{3})(\d{4})(\d{1,4})/, '$1-$2-$3');
    } else {
      e.target.value = numbers;
    }
  });
  
  const birthdateInput = document.getElementById('birthdate');
  birthdateInput.addEventListener('input', function(e) {
    let numbers = e.target.value.replace(/[^0-9]/g, '');
    if (e.inputType !== 'deleteContentBackward' && e.target.value.match(/[^0-9.]/g)) {
      alert('생년월일은 숫자와 점(.)만 입력 가능합니다. 예: 1900.01.01');
      numbers = numbers.replace(/[^0-9]/g, '');
    }
  
    if (numbers.length > 8) {
      numbers = numbers.substring(0, 8);
    }
  
    if (numbers.length === 8) {
      const year = numbers.substring(0, 4);
      const month = numbers.substring(4, 6);
      const day = numbers.substring(6, 8);
      e.target.value = `${year}.${month}.${day}`;
    } else {
      e.target.value = numbers;
    }
  });
  
  // 비밀번호 입력 검증
  const passwordInput = document.getElementById('password');
  const passwordConfirmInput = document.getElementById('passwordConfirm');
  const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+=\-{}\[\]:;"'<>,.?/]).{8,}$/;
  
  passwordInput.addEventListener('blur', function() {
    if (!passwordPattern.test(passwordInput.value)) {
      alert('비밀번호는 영문, 숫자, 특수문자를 모두 포함하여 8자 이상이어야 합니다.');
      passwordInput.value = '';
    }
  });
  
  passwordConfirmInput.addEventListener('blur', function() {
    if (passwordInput.value && passwordConfirmInput.value && passwordInput.value !== passwordConfirmInput.value) {
      alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
      passwordConfirmInput.value = '';
      passwordInput.value = '';
    }
  });
  
  // 비밀번호 보기/숨기기
  const togglePasswordBtn = document.getElementById('togglePassword');
  togglePasswordBtn.addEventListener('click', () => {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    togglePasswordBtn.textContent = type === 'password' ? '보기' : '숨기기';
  });
  
  const togglePasswordConfirmBtn = document.getElementById('togglePasswordConfirm');
  togglePasswordConfirmBtn.addEventListener('click', () => {
    const type = passwordConfirmInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordConfirmInput.setAttribute('type', type);
    togglePasswordConfirmBtn.textContent = type === 'password' ? '보기' : '숨기기';
  });
  
  // 아이디 중복확인 기능
  const checkUsernameBtn = document.getElementById('checkUsernameBtn');
  checkUsernameBtn.addEventListener('click', async function() {
    const username = document.getElementById('username').value.trim();
    if (!username) {
      alert('아이디를 입력하세요.');
      return;
    }
  
    try {
      const response = await fetch(`/check-username?username=${encodeURIComponent(username)}`);
      const result = await response.json();
  
      if (result.exists) {
        alert('이미 등록된 아이디입니다.');
      } else {
        alert('사용 가능한 아이디입니다.');
      }
    } catch (error) {
      console.error('중복확인 에러:', error);
      alert('오류가 발생했습니다. 다시 시도하세요.');
    }
  });

  function handleBankSelect(select) {
    const input = document.getElementById('customBankInput');
    const selected = select.value;

    if (selected === '기타') {
      input.classList.remove('d-none');
      input.setAttribute('required', 'required');
    } else {
      input.classList.add('d-none');
      input.removeAttribute('required');
      input.value = ''; // 기타 → 다른 은행 선택 시 입력값 초기화
    }
  }
  
  const bankSelect = document.getElementById('bankNameSelect');
  const bankInput = document.getElementById('bankNameInput');

  bankSelect.addEventListener('change', function () {
    if (this.value === '직접입력') {
      bankInput.disabled = false;
      bankInput.required = true;
      bankInput.focus();
    } else {
      bankInput.disabled = true;
      bankInput.required = false;
      bankInput.value = '';
    }
  });

  </script>
  